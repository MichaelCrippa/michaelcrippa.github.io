<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jukebox Audio Player - Animazioni 3D Straordinarie</title>
  <!-- Inclusione del font Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Stile base per il body */
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px;
      background: #000; /* Sfondo scuro */
      overflow: hidden;
    }
    /* Background interattivo con particelle */
    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      background: #000;
    }
    /* Pulsante per mostrare/nascondere il Player (fisso in alto a destra) */
    .toggle-player {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 3000;
      padding: 8px 12px;
      background: #007BFF;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      /* Animazione per attirare l'attenzione (durata rallentata a 3s) */
      animation: tremble 3s ease-in-out infinite;
    }
    /* Keyframes per l'animazione tremble */
    @keyframes tremble {
      0%   { transform: translate(0, 0); }
      25%  { transform: translate(-3px, 3px); }
      50%  { transform: translate(3px, -3px); }
      75%  { transform: translate(-3px, 3px); }
      100% { transform: translate(0, 0); }
    }
    /* Contenitore del Jukebox: inizialmente nascosto */
    .jukebox-container {
      position: fixed;
      top: 50px;
      right: 10px;
      width: 476px;
      aspect-ratio: 1/1;
      background: url('jukebox.png') no-repeat center center;
      background-size: contain;
      z-index: 1000;
      display: none; /* Nascondi il jukebox all'avvio */
    }
    @media (max-width: 500px) {
      .jukebox-container {
        width: 90%;
        right: 5%;
      }
    }
    /* Elementi interattivi (pulsanti) posizionati in percentuale rispetto a 476×476 */
    .control-element {
      position: absolute;
      background: transparent;
      border: none;
      cursor: pointer;
      opacity: 0;
    }
    /* Riquadro per il testo della canzone (visibile) */
    .title-display {
      left: 30%;
      top: 43.1%;
      width: 43.3%;
      height: 6.9%;
      opacity: 1 !important;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9em;
      color: #000;
    }
    /* Pulsanti invisibili (Play, Pause, Mute, Unmute, Select, Restart) */
    .play-button    { left: 34.5%; top: 53.2%; width: 10.7%; height: 4.0%; }
    .pause-button   { left: 34.5%; top: 58.6%; width: 10.5%; height: 4.2%; }
    .mute-button    { left: 46.6%; top: 53.2%; width: 10.5%; height: 4.2%; }
    .unmute-button  { left: 46.6%; top: 58.8%; width: 10.5%; height: 4.0%; }
    .select-button  { left: 58.8%; top: 53.4%; width: 10.5%; height: 4.0%; }
    .restart-button { left: 58.8%; top: 59.0%; width: 10.5%; height: 3.8%; }
    /* Lista dei brani (dropdown) */
    .track-list {
      position: absolute;
      top: 320px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 5px;
      z-index: 2000;
      max-height: 150px;
      overflow-y: auto;
      display: none;
      width: 80%;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .track-list li {
      list-style: none;
      padding: 5px;
      cursor: pointer;
    }
    .track-list li:hover {
      background: #eee;
    }
    /* Slider per la regolazione del volume, posizionato in basso al centro del container */
    .volume-slider-container {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 1500;
      background: rgba(255,255,255,0.7);
      padding: 5px 10px;
      border-radius: 5px;
    }
    .volume-slider-container label {
      font-size: 0.9em;
      color: #000;
      margin-right: 5px;
    }
    .volume-slider-container input[type="range"] {
      width: 150px;
    }
    /* DEFINIZIONE DELLE ANIMAZIONI 3D STRAORDINARIE (con durata maggiore per rallentare l'effetto) */
    /* Animazione complex3D: variazioni di rotazioni e scale con opacità */
    @keyframes complex3D {
      0% {
        transform: perspective(800px) rotateX(0deg) rotateY(0deg) scale(1);
        opacity: 0.6;
      }
      30% {
        transform: perspective(800px) rotateX(20deg) rotateY(15deg) scale(1.1);
        opacity: 1;
      }
      50% {
        transform: perspective(800px) rotateX(-20deg) rotateY(-15deg) scale(0.95);
        opacity: 0.8;
      }
      70% {
        transform: perspective(800px) rotateX(15deg) rotateY(20deg) scale(1.05);
        opacity: 1;
      }
      100% {
        transform: perspective(800px) rotateX(0deg) rotateY(0deg) scale(1);
        opacity: 0.6;
      }
    }
    /* Animazione rotate3D: rotazione completa su entrambi gli assi */
    @keyframes rotate3D {
      0% { transform: perspective(800px) rotateX(0deg) rotateY(0deg); }
      50% { transform: perspective(800px) rotateX(360deg) rotateY(360deg); }
      100% { transform: perspective(800px) rotateX(0deg) rotateY(0deg); }
    }
    /* Animazione flip3D: effetto flip sull'asse X */
    @keyframes flip3D {
      0% { transform: perspective(800px) rotateX(0deg); }
      50% { transform: perspective(800px) rotateX(180deg); }
      100% { transform: perspective(800px) rotateX(360deg); }
    }
    /* Animazione spectacular3D: effetto ultra dinamico con trasformazioni, traslazioni e filtri */
    @keyframes spectacular3D {
      0% {
        transform: perspective(800px) rotateX(0deg) rotateY(0deg) scale(1) translateY(0);
        filter: brightness(1) blur(0px);
        opacity: 1;
      }
      20% {
        transform: perspective(800px) rotateX(10deg) rotateY(-10deg) scale(1.1) translateY(-10px);
        filter: brightness(1.2) blur(0px);
        opacity: 1;
      }
      40% {
        transform: perspective(800px) rotateX(-15deg) rotateY(15deg) scale(0.9) translateY(5px);
        filter: brightness(0.8) blur(1px);
        opacity: 0.9;
      }
      60% {
        transform: perspective(800px) rotateX(5deg) rotateY(5deg) scale(1.05) translateY(-5px);
        filter: brightness(1.1) blur(0.5px);
        opacity: 1;
      }
      80% {
        transform: perspective(800px) rotateX(-5deg) rotateY(-5deg) scale(1) translateY(0);
        filter: brightness(1) blur(0px);
        opacity: 1;
      }
      100% {
        transform: perspective(800px) rotateX(0deg) rotateY(0deg) scale(1) translateY(0);
        filter: brightness(1) blur(0px);
        opacity: 1;
      }
    }
    /* Classi per applicare ciascuna animazione 3D (durata aumentata a 6s per le prime tre e 6s per spectacular3D) */
    .complex3D { animation: complex3D 6s ease-in-out infinite; }
    .rotate3D  { animation: rotate3D 6s ease-in-out infinite; }
    .flip3D    { animation: flip3D 6s ease-in-out infinite; }
    .spectacular3D { animation: spectacular3D 6s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite; }
  </style>
</head>
<body>
  <!-- Div per il background interattivo con particelle -->
  <div id="particles-js"></div>
  
  <!-- Pulsante per mostrare/nascondere il Player -->
  <button id="toggle-player" class="toggle-player">Show Player</button>
  
  <!-- Contenitore del Jukebox -->
  <div class="jukebox-container" id="jukebox-container">
    <!-- Riquadro visibile per il testo della canzone -->
    <div class="control-element title-display" id="song-display">
      Peggy Suave - Enemy Like Me
    </div>
    <!-- Controlli interattivi (invisibili) -->
    <button class="control-element play-button" id="play-button">Play</button>
    <button class="control-element pause-button" id="pause-button">Pause</button>
    <button class="control-element mute-button" id="mute-button">Mute</button>
    <button class="control-element unmute-button" id="unmute-button">Unmute</button>
    <button class="control-element select-button" id="select-button">Select</button>
    <button class="control-element restart-button" id="restart-button">Restart</button>
    
    <!-- Lista dei brani (dropdown) -->
    <ul class="track-list" id="track-list">
      <!-- Gli elementi verranno creati dinamicamente -->
    </ul>
    
    <!-- Slider per la regolazione del volume -->
    <div class="volume-slider-container">
      <label for="volume-slider">Volume</label>
      <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.2">
    </div>
  </div>
  
  <!-- Elemento audio -->
  <audio id="audio-player" src="sottofondo.mp3" loop></audio>
  
  <!-- Includiamo la libreria Particles.js tramite CDN -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  
  <script>
    /* Inizializza Particles.js per il background interattivo */
    particlesJS("particles-js", {
      "particles": {
        "number": {
          "value": 50,
          "density": {
            "enable": true,
            "value_area": 800
          }
        },
        "color": { "value": "#ffffff" },
        "shape": {
          "type": "circle",
          "stroke": { "width": 0, "color": "#000000" },
          "polygon": { "nb_sides": 5 }
        },
        "opacity": { "value": 0.5, "random": false },
        "size": { "value": 3, "random": true },
        "line_linked": {
          "enable": true,
          "distance": 150,
          "color": "#ffffff",
          "opacity": 0.4,
          "width": 1
        },
        "move": {
          "enable": true,
          "speed": 6,
          "direction": "none",
          "random": false,
          "straight": false,
          "out_mode": "out"
        }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {
          "onhover": { "enable": true, "mode": "repulse" },
          "onclick": { "enable": true, "mode": "push" },
          "resize": true
        },
        "modes": {
          "repulse": { "distance": 200, "duration": 0.4 },
          "push": { "particles_nb": 4 }
        }
      },
      "retina_detect": true
    });
    
    /* --- Gestione dell'Audio e Animazioni 3D del Jukebox --- */
    const audio = document.getElementById('audio-player');
    const playBtn = document.getElementById('play-button');
    const pauseBtn = document.getElementById('pause-button');
    const muteBtn = document.getElementById('mute-button');
    const unmuteBtn = document.getElementById('unmute-button');
    const restartBtn = document.getElementById('restart-button');
    const selectBtn = document.getElementById('select-button');
    const songDisplay = document.getElementById('song-display');
    const trackList = document.getElementById('track-list');
    const volumeSlider = document.getElementById('volume-slider');
    const jukeboxContainer = document.getElementById('jukebox-container');
    const toggleBtn = document.getElementById('toggle-player');
    
    // Imposta il volume iniziale
    audio.volume = volumeSlider.value;
    
    // Array dei brani
    const tracks = [
      { name: "Grumpy Shark - Absurd Extravaganza", file: "track3.mp3" },
      { name: "Peggy Suave - Tellin' & Posin'", file: "track2.mp3" },
      { name: "Peggy Suave - Enemy Like Me", file: "sottofondo.mp3" },
      { name: "Wreck-It Ralph - Royal Raceway", file: "Wreck-It Ralph OST - 12 - Royal Raceway.mp3" }
    ];
    
    // Popola la lista dei brani
    function populateTrackList() {
      trackList.innerHTML = "";
      tracks.forEach(track => {
        const li = document.createElement('li');
        li.textContent = track.name;
        li.addEventListener('click', () => {
          audio.src = track.file;
          songDisplay.textContent = track.name;
          trackList.style.display = "none";
          audio.play().then(() => {
            updateButtons();
            updateAnimation();
          }).catch(error => console.error("Errore durante la riproduzione:", error));
        });
        trackList.appendChild(li);
      });
    }
    populateTrackList();
    
    // Aggiorna lo stato dei pulsanti
    function updateButtons() {
      if (audio.paused) {
        playBtn.style.pointerEvents = "auto";
        pauseBtn.style.pointerEvents = "none";
      } else {
        playBtn.style.pointerEvents = "none";
        pauseBtn.style.pointerEvents = "auto";
      }
      if (audio.muted) {
        muteBtn.style.pointerEvents = "none";
        unmuteBtn.style.pointerEvents = "auto";
      } else {
        muteBtn.style.pointerEvents = "auto";
        unmuteBtn.style.pointerEvents = "none";
      }
    }
    
    // Funzione per aggiornare l'animazione 3D casuale del jukebox (solo animazioni 3D)
    function updateAnimation() {
      const animations = ['complex3D', 'rotate3D', 'flip3D', 'spectacular3D'];
      animations.forEach(anim => jukeboxContainer.classList.remove(anim));
      if (!audio.paused) {
        const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
        jukeboxContainer.classList.add(randomAnimation);
      }
    }
    
    // Eventi per i controlli
    playBtn.addEventListener('click', () => {
      audio.play().then(() => {
        updateButtons();
        updateAnimation();
      }).catch(error => console.error("Errore durante la riproduzione:", error));
    });
    
    pauseBtn.addEventListener('click', () => {
      audio.pause();
      updateButtons();
      updateAnimation();
    });
    
    muteBtn.addEventListener('click', () => {
      audio.muted = true;
      updateButtons();
    });
    
    unmuteBtn.addEventListener('click', () => {
      audio.muted = false;
      updateButtons();
    });
    
    restartBtn.addEventListener('click', () => {
      audio.currentTime = 0;
      audio.play().then(() => {
        updateButtons();
        updateAnimation();
      }).catch(error => console.error("Errore durante il riavvio:", error));
    });
    
    selectBtn.addEventListener('click', () => {
      trackList.style.display = (trackList.style.display === "none" || trackList.style.display === "") ? "block" : "none";
    });
    
    volumeSlider.addEventListener('input', () => {
      audio.volume = volumeSlider.value;
    });
    
    toggleBtn.addEventListener('click', () => {
      // Verifica la visualizzazione attuale tramite getComputedStyle
      if (getComputedStyle(jukeboxContainer).display === "none") {
        jukeboxContainer.style.display = "block";
        toggleBtn.textContent = "Hide Player";
      } else {
        jukeboxContainer.style.display = "none";
        toggleBtn.textContent = "Show Player";
      }
    });
    
    // Gestione della visibilità della pagina
    let wasPlaying = false;
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        wasPlaying = !audio.paused;
        audio.pause();
        updateButtons();
        updateAnimation();
      } else if (wasPlaying) {
        audio.play().then(() => {
          updateButtons();
          updateAnimation();
        }).catch(error => console.error("Errore durante il ripristino della riproduzione:", error));
      }
    });
  </script>
</body>
</html>
